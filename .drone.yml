build:
  image: golang:alpine
  environment:
    - CGO_ENABLED=0
  commands:
    - apk update
    - apk add git make
    - make

publish:
  docker:
    username: $$DOCKER_USER
    password: $$DOCKER_PASS
    email: $$DOCKER_EMAIL
    repo: metalmatze/krautreporter-api
    file: Dockerfile.api
    tag: latest
    storage_driver: vfs
    when:
      branch: go
  docker:
    username: $$DOCKER_USER
    password: $$DOCKER_PASS
    email: $$DOCKER_EMAIL
    repo: metalmatze/krautreporter-crawler
    file: Dockerfile.crawler
    tag: latest
    storage_driver: vfs
    when:
      branch: go
